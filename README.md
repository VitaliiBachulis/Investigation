# Investigation Ref Struct and Fixed Buffer issues.

	Given that we have 2 ref structs folded one another and an inner one has a large fixed buffer with Span - pointing on that fixed buffer and Span is initialized in struct's constructor.
	So we need to initialize inner struct as a field of outher struct by calling it's constructor.
	When we run example code ("Investigation" project) we catch the next exception:

Fatal error. System.AccessViolationException: Attempted to read or write protected memory. This is often an indication that other memory is corrupt.
   at IntruderAlert.DebounceMeasurement.MakeMeasurement()
   at IntruderAlert.Room.TakeMeasurements(Int32)
   at Program.<Main>$(System.String[])

C:\Users\vetal\Documents\Study\Investigation\Investigation\bin\Release\net7.0\Investigation.exe (process 16708) exited with code -1073741819.

The cause is of IL code generated by Roslyn compiler in an outer struct constructor:

.class IntruderAlert.Room	

.method public hidebysig specialname rtspecialname 
	instance void .ctor () cil managed 
{
	.maxstack 8
	IL_0000: ldarg.0
	IL_0001: newobj instance void IntruderAlert.DebounceMeasurement::.ctor()
	IL_0006: stfld valuetype IntruderAlert.DebounceMeasurement IntruderAlert.Room::debounce
	IL_000b: ret
} // end of method Room::.ctor

After decompile resulting assembly by ILDasm and change the constractor's code to the below and recompile new assebly by ILAsm. The issue disappears.

.class IntruderAlert.Room

.method public hidebysig specialname rtspecialname 
	instance void .ctor () cil managed 
{
	.maxstack 1
	IL_0000: nop
	IL_0001: ldarg.0
	IL_0002: call instance void IntruderAlert.DebounceMeasurement::.ctor()
	IL_0007: ret
} // end of method Room::.ctor

	The project "WorkingExample" exists for a sake of comparing structs memory layouts on physical memory addresses by WinDbg.